<section class="inventory">
  <header class="inventory__header">
    <div>
      <h1>Inventory</h1>
      <p>Manage catalog items, supplier assignments, and restock thresholds.</p>
    </div>
    <button mat-raised-button color="primary" (click)="openCreateDialog()" [disabled]="processing()">
      <mat-icon fontIcon="add"></mat-icon>
      <span>Add Item</span>
    </button>
  </header>

  <mat-form-field appearance="outline" class="inventory__filter">
    <mat-label>Search inventory</mat-label>
    <input
      matInput
      type="search"
      placeholder="Filter by name, SKU, or supplier"
      [value]="filter()"
      (input)="filter.set($any($event.target).value)"
    />
    <button
      *ngIf="filter()"
      mat-icon-button
      matSuffix
      type="button"
      (click)="filter.set('')"
      aria-label="Clear filter"
    >
      <mat-icon fontIcon="close"></mat-icon>
    </button>
  </mat-form-field>

  <mat-progress-bar *ngIf="loading()" mode="indeterminate"></mat-progress-bar>

  <div class="inventory__table-container" *ngIf="filteredItems().length > 0; else emptyState">
    <table mat-table [dataSource]="filteredItems()" [trackBy]="trackById">
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let item">
          <div class="inventory__cell-primary">{{ item.name }}</div>
          <div class="inventory__cell-secondary">SKU: {{ item.sku }}</div>
        </td>
      </ng-container>

      <ng-container matColumnDef="sku">
        <th mat-header-cell *matHeaderCellDef>SKU</th>
        <td mat-cell *matCellDef="let item">{{ item.sku }}</td>
      </ng-container>

      <ng-container matColumnDef="supplier">
        <th mat-header-cell *matHeaderCellDef>Supplier</th>
        <td mat-cell *matCellDef="let item">{{ item.supplierId || 'â€”' }}</td>
      </ng-container>

      <ng-container matColumnDef="quantity">
        <th mat-header-cell *matHeaderCellDef> Stock </th>
        <td mat-cell *matCellDef="let item">
          <div class="inventory__quantity">
            <span>{{ item.quantity }}</span>
            <small class="inventory__quantity-threshold">Reorder at {{ item.reorderLevel }}</small>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef> Unit Price </th>
        <td mat-cell *matCellDef="let item">
          {{ item.unitPrice | currency }}
        </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let item">
          <mat-chip *ngIf="item.needsReorder" color="warn" selected>
            Needs restock
          </mat-chip>
          <mat-chip *ngIf="!item.needsReorder" color="primary" selected>
            Healthy
          </mat-chip>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let item" class="inventory__actions">
          <button mat-icon-button matTooltip="Edit item" (click)="openEditDialog(item)" [disabled]="processing()">
            <mat-icon fontIcon="edit"></mat-icon>
          </button>
          <button
            *ngIf="canDelete()"
            mat-icon-button
            color="warn"
            matTooltip="Remove item"
            (click)="deleteItem(item)"
            [disabled]="processing()"
          >
            <mat-icon fontIcon="delete"></mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>

  <ng-template #emptyState>
    <div class="inventory__empty">
      <mat-icon fontIcon="inventory_2"></mat-icon>
      <h2>No items yet</h2>
      <p>Add your first inventory item to start tracking stock health.</p>
      <button mat-stroked-button color="primary" (click)="openCreateDialog()">Create Item</button>
    </div>
  </ng-template>
</section>

